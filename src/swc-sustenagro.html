<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/iron-icons">
<link rel="import" href="../bower_components/iron-icon">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="./swc-dsl-editor.html">
<link rel="import" href="./swc-dsl-render.html">
<link rel="import" href="./swc-tabs-pages.html">

<dom-module id="swc-sustenagro">
    <template>
        <style include="iron-flex iron-flex-alignment">

        </style>
        <div id="view">

        </div>
  </template>

  <script>
    Polymer({
        is: 'swc-sustenagro',

        ready: function(){
            var renderDiv = this.$.view;

            RestClient({path: 'http://localhost:8080/'}).then(function (response) {
                render(response.entity, renderDiv)
            });
        }
    });

    function render(elements, parent){
        for(var idx in elements){
            var element = elements[idx];
            var swc = createWebComponent(element, parent);
            setTimeout(createSubTree.bind(null, element, swc), 0);
        }
    }

    function createSubTree(element, swc) {
        var children = element.children;
        for(var idc in children){
            var container = undefined;
            if(swc !== undefined){
                container = (typeof swc.getContainer === "function") ? swc.getContainer(idc) : swc;
            }
            else{
                container = parent;
            }

            var current = (children[idc].widget)? element : children[idc];

            render(current.children, container)
        }
    }

    function createWebComponent(element, parent){
        if(typeof element.widget == 'undefined'){
            return undefined;
        }
        else{
            switch (element.widget){
                case 'swc-tabs-pages':
                    var tag = document.createElement(element.widget);
                    var tabsItems = [];

                    for(var idx in element.children){
                        tabsItems.push({"name": element.children[idx].label});
                    }
                    tag.setAttribute("tab-items", JSON.stringify(tabsItems));
                    parent.appendChild(tag);
                    return tag;
                    break;
                default:
                    var tag = document.createElement(element.widget);
                    //tag.setAttribute('id', );

                    if(element.label) {
                        tag.innerHTML = element.label;
                    }
                    parent.appendChild(tag);
                    return tag;
            }
        }
    }

  </script>
</dom-module>
