<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/iron-component-page/iron-component-page.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/iron-icons">
<link rel="import" href="../bower_components/iron-icon">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html">

<link rel="import" href="./swc-dsl-editor.html">
<link rel="import" href="./swc-dsl-render.html">
<link rel="import" href="./swc-tabs-pages.html">

<dom-module id="swc-sustenagro">
    <template>
        <style>

            app-header {
                background-color: white;
            }

            app-toolbar {
                background-color: white;
                box-shadow: 0px 5px 6px -3px rgba(0, 0, 0, 0.4);
            }

            .content {
                padding: 16px 40px;
            }

            .card {
                background-color: white;
                max-width: 720px;
                margin: 16px auto;
                box-shadow: 0 1px 4px 0 rgba(0, 0, 0, 0.37);
            }

            @media (max-width: 600px) {
                .content {
                    padding: 0;
                }
                .card {
                    margin: 8px;
                }
            }
        </style>
        <app-header-layout>
            <app-header fixed effects="waterfall">
                <app-toolbar>
                    <paper-icon-button icon="menu"></paper-icon-button>
                    <div main-title>SustenAgro</div>
                </app-toolbar>
            </app-header>


            <form is="iron-form" id="form" method="post" action="/form/handler">
                <div id="view" class="content">

                </div>
            </form>

        </app-header-layout>
  </template>

  <script>
    Polymer({
        is: 'swc-sustenagro',

        ready: function(){
            var renderDiv = this.$.view;

            RestClient({path: 'http://localhost:8080/'}).then(function (response) {
                //render(response.entity, renderDiv);
                renderHTML(response.entity);
                renderDiv.innerHTML = html;
            });
        }
    });

    function render(elements, parent){
        if(typeof elements != 'undefined' && elements.length > 0) {
            for (var idx in elements) {
                var element = elements[idx];
                var swc = createWebComponent(element, parent);

                setTimeout(createSubTree.bind(null, element, swc), 0);
            }
        }
    }

    function createSubTree(element, swc) {
        var children = element.children;
        var current = element;
        var container = swc;

        if(typeof swc.getContainer === "function"){
            for(var idc in children){
                current = children[idc];
                container = swc.getContainer(idc)
                render(current.children, container)
            }
        }
        else{
            render(current.children, container)
        }
    }

    function createWebComponent(element, parent){
        if(typeof element.widget == 'undefined'){
            return undefined;
        }
        else{
            switch (element.widget){
                case 'swc-tabs-pages':
                    var tag = document.createElement(element.widget);
                    var tabsItems = [];

                    for(var idx in element.children){
                        tabsItems.push({"name": element.children[idx].label});
                    }
                    tag.setAttribute("tab-items", JSON.stringify(tabsItems));
                    parent.appendChild(tag);
                    return tag;
                    break;
                default:
                    var tag = document.createElement(element.widget);

                    if(element.id)
                        tag.setAttribute('id', element.id);

                    if(element.name)
                        tag.setAttribute('name', element.name);

                    if(element.value)
                        tag.setAttribute('value', element.value);

                    if(element.label){
                        var content = document.createTextNode(element.label);
                        tag.appendChild(content)
                    }

                    if(element['aria-labelledby'])
                        tag.setAttribute('aria-labelledby', element['aria-labelledby']);

                    if(element.value)
                        tag.value = element.value;

                    if(element.type)
                        tag.setAttribute('type', element.type);

                    parent.appendChild(tag);
                    return tag;
            }
        }
    }

    var html = '';

    function renderHTML(elements){
        if(typeof elements != 'undefined' && elements.length > 0) {
            for (var idx in elements) {
                var element = elements[idx];

                if(typeof element.widget != 'undefined'){
                    html += createStartTagHTML(element);
                }

                renderHTML(element.children);

                if(typeof element.widget != 'undefined'){
                    html += createEndTagHTML(element);
                }
            }
        }
    }

    function createStartTagHTML(element){
        switch(element.widget){
            case 'swc-tabs-pages':
                var tabsItems = [];

                for(var idx in element.children){
                    tabsItems.push({"name": element.children[idx].label, "id": element.children[idx].id});
                }

                return "<swc-tabs-pages tab-items='"+JSON.stringify(tabsItems)+"'>";
                break;
            default:
                var tag = '<'+element.widget+' ';

                if(element.id)
                    tag += 'id="'+element.id+'" ';

                if(element.name)
                    tag += 'name="'+element.name+'" ';

                if(element.value)
                    tag += 'value="'+element.value+'" ';

                if(element['aria-labelledby'])
                    tag += 'aria-labelledby="'+element['aria-labelledby']+'" ';

                tag += '>'

                if(element.label){
                    tag += element.label;
                }
                return tag;
        }

    }

    function createEndTagHTML(element) {
        return '</' + element.widget + '>';
    }

  </script>
</dom-module>
